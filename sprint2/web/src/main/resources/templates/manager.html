<!DOCTYPE html>
<html lang="en">
<head>
	<title>ParkingManagerService</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<style>

        /* Add a gray background color and some padding to the footer */
        footer {
            background-color: #e3f2f2;
            padding: 25px;
        }
	</style>
	<script>
		$(function () {
			$("#controlTrolley").on("click", function () {
				let state = "stopped"
				$.post("/api/manager/setTrolley/"+state, function (response) {
					let data = $.parseJSON(response);
					if(data.ok) {
						setTimeout(update, 1000);
					} else {
						alert("Error: " + data.errorMessage);
					}
				});
			});
		});
		updateRecursive();
		function update() {
			$.getJSON("/api/manager/status", function (data) {
				console.log(data);
				if(data.trolleyState === "STOPPED") {
					$("#controlTrolley").text("START");
					$("#controlTrolley").prop("data-action", "working");
				} else {
					$("#controlTrolley").text("STOP");
					$("#controlTrolley").prop("data-action", "stopped");
				}
				$("#fanState").text(data.fanState);
				$("#temperatureState").text(data.sensors.temperature.measure);
				$("#temperatureStateTime").text(getTime(data.sensors.temperature.time));
				if(data.outdoorAlarm) {
					$("#dtfree").show();
				} else {
					$("#dtfree").hide();
				}
			});
		}
		function updateRecursive() {
			update();
			setTimeout(updateRecursive, 10000);
		}
		function getTime(timestamp) {
			let dateObj = new Date(timestamp * 1000);
			let hour = dateObj.getHours();
			let min = dateObj.getMinutes();
			let sec = dateObj.getSeconds();
			return "" + (hour >= 10 ? hour : "0" + hour) + ":" + (min >= 10 ? min : "0" + min) + ":" + (sec >= 10 ? sec : "0" + sec);
		}
	</script>
</head>
<body>

<div class="p-7 mb-4 bg-light rounded-3 text-center">
	<div class="container-fluid py-5">
		<h1 class="display-4 fw-bold">ParkManagerService</h1>
		<p class="fs-4">by Musarella & Tripi</p>
	</div>
</div>



<div class="container text-center">
	<div class="row">
		<div class="col">
			<p>A completely free parking service, gently offered by the University of Bologna</p>

		</div>
		<div class="col">
			<img src="images/parkingArea.jpg" class="img-responsive" style="width:20%" alt="Image">
		</div>
	</div>
	<div class="row">

	</div>
	<div class="row" id="temperature">
		<div class="col">
			Current temperature inside the parking area is
		</div>
		<div class="col">
			<span id="temperatureState"></span>
			<span id="temperatureStateTime"></span>
			<!-- anche last update -->
		</div>
	</div>
	<div class="row" id="fan">
		<div class="col">
			Current fan state is
		</div>
		<div class="col">
			<span id="fanState"></span>
			<!-- anche last update -->
		</div>
	</div>
	<div class="row" id="trolley">
		<div class="col">
			To control the parking trolley
		</div>
		<div class="col">
			<button type="button" class="btn btn-primary" id="controlTrolley" data-action="">Stop/start</button>
		</div>
	</div>
	<div class="row" id="dtfree" style="display: none">
		<div class="col">
			Alert OUTDOOR ON
		</div>
		<div class="col">
			CHECK IMMEDIATELY!!!!
		</div>
	</div>
</div><br>


<footer class="container-fluid">
	<p>Project for the course Ingegneria dei Sistemi Software M, UNIBO</p>
	<p>By Alessandro Musarella <a style="color: grey" href="mailto:alessandro.musarella@studio.unibo.it">alessandro.musarella@studio.unibo.it</a><br>
		By Giulio Tripi <a style="color: grey" href="mailto:giulio.tripi@studio.unibo.it">giulio.tripi@studio.unibo.it</a><br>
		GitHub: <a style="color: grey" href="https://github.com/giuliotripi/ParkManagerService">https://github.com/giuliotripi/ParkManagerService</a></p>
</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</body>
</html>
