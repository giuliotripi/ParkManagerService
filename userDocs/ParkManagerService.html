<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<!--
<link rel="stylesheet" type="text/css" href="../css/issStyle1.css">
<script type="text/javascript" src="../css/issStyle.js"></script>
-->
<style type="text/css">
    body {
        margin-left: 30px;
        margin-right: 30px;
    }

    P {
        font-family: Tahoma;
        font-size: 10pt;
    }

    a, a:visited, a:active, a:link, a:hover {
        text-decoration: underline;
        color: #545454;
        background-color: transparent;
        font-size: 93%;
    }

    a:hover {
        background-color: #cccccc;
    }


    hr {
        clear: both;
        height: 1px;
        color: #242424;
        background-color: transparent;
    }

    h1, h2, h3 {
        color: #242424;
        clear: left;
        font: 100% Tahoma, Helvetica, Arial, sans-serif;
        margin-bottom: 0.5em;
        padding-top: 0.5em;
        border-radius: 10px;
        padding: 5px;
    }

    top {
        width: 100%;
    }


    #i {
        color: #ff1010;
    }

    tt {
        font-family: "Arial";
        font-size: 90%;
        color: #006600;
    }

    em {
        font-family: "Arial";
        font-size: 80%;
        font-weight: bold;
        border-style: solid;
        border-color: #abe876;
        color: #1632cc;
    }

    bc {
        font-family: "Arial";
        font-size: 90%;
        font-weight: bold;
        color: #990000;
        background-color: #fcf8c7;
    }

    ks {
        font-family: "Arial";
        font-weight: bold;
        color: #0000CD;
        font-size: 90%;
    }

    kc {
        font-family: "Arial";
        font-weight: bold;
        color: #008000;
        font-size: 90%;
    }

    pre {
        font-family: "Consolas";
        font-size: 85%;
        background-color: #f5f5f5;
        border: 1.5px solid silver;
        padding: 5px;
    }

    m {
        font-family: "Helvetica";
        line-height: 100%;
        font-size: 75%;
    }

    div.body {

        font-size: 18px;
    }

    k {
        color: #990000;
        font-weight: bold;
    }

    h1 {
        font-size: 150%;
        background-color: #b2c0ff;
        padding: 10px;
    }

    h2 {
        background-color: #9ed8ff;
        font-size: 130%;
    }

    h3 {
        background-color: #e6ccff;
        font-size: 100%;
    }

    h4 {
        background-color: #ccffcc;
        font-size: 100%;
        width: 95%;
        border-radius: 5px;
        padding: 2px;
    }

    h5 {
        background-color: #d5ffb0;
        font-size: 100%;

    }

    div.req {
        background-color: #d9ffb3;
        font-size: 18px;
        width: 700px;
        border: 3px solid green;
        padding: 15px;
        margin: 10px;
    }

    div.remark {
        background-color: #E3F2FD;
        border: 1.5px solid #d5f2ed;
        padding: 15px;
        margin: 10px;
        border-radius: 25px;
    }

    table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
    }

    ol, ul, li {
        margin: 0;
        margin-left: 10px;
        padding: 0;
        padding-bottom: 5px;
    }

    table, th, td {
        border: 1px solid black;
    }

    img {
        border: 1.5px solid #d5f2ed

    }

    a, a:visited, a:active, a:link, a:hover {
        text-decoration: underline;
        color: #545454;
        background-color: transparent;
    }

    div.wrapdesc {
        width: 90%;
        margin: auto;
    }

    div.imagedesc {
        width: 85%;
        margin: auto;
    }
	ol.custom {
		counter-reset: number;
	}
	ol.custom > li {
		list-style: none;
		counter-increment: number;
	}
	ol.custom.functional > li::before {
		content: "F" counter(number) ".";
		position: relative;
		left:-5px
	}
	ol.custom.nonfunctional > li::before {
		content: "NF" counter(number) ".";
		position: relative;
		left:-5px
	}
</style>

	<title>ParkManagerService</title>
	<link rel="icon" href="img/favicon.png">
</head>

<body>
<div id="top">
	<h1>ESAME DI INGEGNERIA DEI SISTEMI SOFTWARE <font size="5"></font></h1>
</div>

<div class="body">
	<h2>Introduction</h2>


	<h2>Requirements</h2>
	<div class="remark">
		The document written by the customer with the requirements can be found <a href="TFBO21ParkingISS.pdf">here</a>.
	</div>


	<h2>Requirement analysis</h2>
	<div class="remark">
		<h3>Dictionary</h3>
		<h4>Nouns</h4>
		<ul>
			<li><ks>ParkManagerService</ks>: The software system which will implement the required automation functions;</li>
			<li><ks>DDR robot</ks>: Differential Drive Robot. Has the form of a square of side length RD;</li>
			<li><ks>transport trolley</ks>: A DDR robot which is used to move cars from the INDOOR to the selected
				parking-slot;</li> <!-- TODO: how to control it? -->
			<li><ks>home</ks>: Starting position for the robot, located in the top-left corner of the environment. When the
				robot completes a request, and there are no further instruction, it will return in this position;</li>
			<li><ks>parking-area</ks>: Empty environment outside which the robot cannot go. It includes INDOOR, INDOOR-area,
				OUTDOOR, OUTDOOR-area, parking-slots, thermometer and a fan;</li>
			<li><ks>INDOOR</ks>: Cars use this gate to enter the parking-area;</li>
			<li><ks>INDOOR-area</ks>: The transport trolley positions itself in this location to pick the car parked in
				front of the INDOOR. It is located inside the parking area;</li>
			<li><ks>weightsensor</ks>: Sensor to measure the weight of the car, located in front of the INDOOR;</li>
			<li><ks>OUTDOOR</ks>: Cars uses this gate to exit from the parking-area;</li>
			<li><ks>OUTDOOR-area</ks>: The transport trolley positions itself in this location to leave the car
				just outside the OUTDOOR. Drivers pick them up there.
				It is located inside the parking area;</li>
			<li><ks>outsonar</ks>: Sensor that detects cars outside the OUTDOOR;</li>
			<li><ks>parking-slots</ks>: Dedicated slots inside the parking area where cars are left by the transport
				trolley. There are 6 parking-slots;</li>
			<li><ks>thermometer</ks>: Sensor used to measure the temperature inside the parking-area;</li>
			<li><ks>fan</ks>: A fan used to reduce the temperature inside the parking-area. It can be manually activated
				by the parking manager, or it can activate automatically. It can be either on or off;</li>
			<li><ks>map</ks>: schematic representation of the parking-area, made by a grid of squares of side length RD;</li>
			<li><ks>fixed obstacles</ks>: Immovable objects that the robot cannot traverse;</li>
			<li><ks>parking-manager</ks>: Person in charge of the parking-area, who supervises the state and handles
				critical situations;</li>
			<li><ks>client</ks>: Person using services of the parking-area. In particular, he will leave and pickup the car;</li>
			<li><ks>ParkServiceGUI</ks>: GUI for parking clients to leave and pick up cars. It can be accessed by the client
				by using their own personal device;</li>
			<li><ks>ParkServiceStatusGUI</ks>: GUI for the parking-manager to manage some aspects of the parking area;</li>
			<li><ks>SLOTNUM</ks>: id of the parking slot given to the client, representing the location where the car will
				be placed by transport trolley. If equal to 0, no parking slots are available</li>
			<li><ks>TOKENID</ks>: sequence of characters. The characters should be generated in a manner that:
				<ul>
					<li>Two cars cannot have the same TOKENID while they are in the parking area</li>
					<li>It is impossible to guess the generated ID (cryptographically secure random)</li>
					<li>The generated ID must have a significative number of character</li>
				</ul></li>
			<li><ks>Alarm</ks> (to the parking manager): notification for the parking manager to signal if the OUTDOOR-area
				is not freed within DTFREE interval of time;</li>
			<li><ks>current state</ks>: Collection of the following information:
				<ul>
					<li>current temperature inside the parking-area;</li>
					<li>current state of the fan (<k>on</k> or <k>off</k>);</li>
					<li>current state of the transport trolley (<k>idle</k>, <k>working</k> or <k>stopped</k>);</li>
				</ul></li>
		</ul>
		<h4>Verbs</h4>
		<ul>
			<li><ks>leave the car</ks>: after receiving the SLOTNUM, the client leaves the car in the INDOOR-area and
				presses the CARENTER button on the ParkServiceGUI. He will then receive the unique TOKENID;</li>
			<li><ks>pick up the car</ks>: the client uses the ParkServiceGUI to request the pick up, by sending the TOKENID
				previously received. After the car is moved to the OUTDOOR-area by the robot, the client takes the car and
				frees the area within DTFREE interval of time;</li>
			<li><ks>start the fan</ks>: when the current temperature inside the parking-area exceeds TMAX, either the
				parking-manager starts manually the fan from the ParkServiceStatusGUI, or the fan starts automatically;</li>
			<li><ks>stop the fan</ks>: when the current temperature goes below TMAX, either the parking-manager stops
				manually the fan from the ParkServiceStatusGUI, or the fan stops automatically;</li>
			<li><ks>stop the robot</ks>: when the current temperature inside the parking-area exceeds TMAX, the
				parking-manager stops the robot, blocking any successive move until he starts the robot again;</li>
			<li><ks>start the robot</ks>: after the parking-manager stops the robot, it remains stopped until restarted
				by the parking-manager;</li>
		</ul>
		<h3>System architecture</h3> <!-- Physical separation between machines, Separation between machines? -->
		The requirements given by the customer point out the structure of the system intended as the distribution of the
		program between different devices:
		<ul>
			<li>The client devices to interact with the ParkServiceGUI;</li>
			<li>The parking manager device to interact with the ParkServiceStatusGUI;</li>
			<li>The ParkManagerService core;</li>
			<li>The transport trolley;</li>
			<li>The three sensors and the fan.</li>
		</ul>
		<h3>Additional user stories</h3>
			Multiple users using the application:
			<ol>
				<li></li>
			</ol>
		<h3>Additional requirements and details</h3>
		<ul>
			<li>The fan is automatically activated/deactivated by ParkManagerService. The parking manager cannot overtake control of it;</li>
			<li>The transport trolley cannot be stopped if TA <= TMAX;</li>
			<li>It is impossible that a customer reaches the INDOOR without having reserved a parking slot from the GUI;</li>
			<li>When client try to do acceptIN, if the transport trolley is stopped, the client should see an error message;</li>
			<li>When parking manager starts the transport trolley, it should continue the move it was doing before stop;</li>
			<li>Temperature is in Celsius and mass in kilograms;</li>
			<li>TMAX and DTFREE will be placed in a configuration file accessible by the application;</li>
			<li>Only the transport trolley is provided by the customers, all the other devices must be chosen and provided by the
				engineering company;</li>
		</ul>
		<h3>List of requirements</h3>
		<h4>Functional requirements</h4>
		<ol class="custom functional">
			<li>The client can book a parking slot through ParkServiceGUI.</li>
			<li>The system sends the client an id of the parking-slot if there are slots available, otherwise it sends 0.</li>
			<li>The client notifies the ParkManagerService when he leaves the car in front of the INDOOR.</li>
			<li>The system can transport the cars from the INDOOR to the parking slots, and from the parking slots to the
				OUTDOOR by sending command to a transport trolley.</li>
			<li>The system should provide a unique identifier to the client (TOKENID), in order to retrieve the car later.</li>
			<li>The system must understand if client's car is not in front of the INDOOR during F3</li>
			<li>The system can accept the request of a client to park in there only if there is at least one parking-slot
				available, the weigthsensor don't detect a car in front of the INDOOR, and the transport trolley is either
				at home or working</li>
			<li>The client can pick up the car by sending the TOKENID through ParkServiceGUI</li>
			<li>The system can accept the request of a client to pick up the car only if the TOKENID is valid, the outsonar
				don't detect a car in front of the OUTDOOR, and the transport trolley is either at home or working</li>
			<li>The system must infer the correct parking-slot from the corresponding TOKENID</li>
			<li>The parking manager can see the current state of the parking area through ParkServiceStatusGUI</li>
			<li>The parking manager should be able to stop the transport trolley when TA > TMAX through ParkServiceStatusGUI</li>
			<li>The parking manager should be able to start the transport trolley when it is stopped through ParkServiceStatusGUI</li>
			<li>ParkManagerService should start the fan when TA > TMAX and stop it when TA <= TMAX</li>
			<li>ParkManagerService should notify the parking manager when the OUTDOOR is not cleaned within DTFREE
			interval of time</li>
		</ol>

		<h4>Non-functional requirements</h4>
		<ol class="custom nonfunctional">
			<li id="NF1">The TOKENID generated must be secure and not easy to guess</li>
		</ol>

		<h4>Transport Trolley</h4>
		The transport trolley is the core entity of the project, as it is responsible for transporting the cars around
		the parking. The customer has provided us the model and the code of a basicrobot (link). The basicrobot is able
		to execute basic move commands, is a CoAP-observable resource, and can interact with a concrete robot. It is
		modelled as an actor. Because we are in a distributed system, and most likely the transport trolley will be on a
		separate node, the transport trolley will be modelled as an active entity, an actor, that wraps the basicrobot.
		The following graphs show the interaction between the transport trolley and the ParkManagerService.

		<img style="max-width: 100%" src="img/trolley-interaction.png" alt="trolley interaction">

		<h4>Other devices</h4>
		We have different devices in the parking area: weight-sensor, outsonar, thermometer, fan.

		As they will all be on different nodes inside the parking area, we will also model these devices as actors.
		Furthermore, the weight sensor, the outsonar and the thermometer must be also capable of sending events, so by
		making them as active entities, we won't have the need to interact with polling. The following graphs show the
		interaction between these devices and the ParkManagerService.

		<img style="max-width: 100%" src="img/sensor-interaction.png" alt="sensor interaction">

		<!-- codice già fornito per il sonar, è un oggetto, incapsularlo in un attore -->


		<img style="max-width: 100%" src="img/logical-architecture2.png" alt="logical architecture">


		<script type="application/javascript">
			let functionalList = document.querySelectorAll('ol.functional.custom > li');
			for (let i = 0; i < functionalList.length; i++)
				functionalList[i].id = 'F' + (i+1);
			let nonfunctionalList = document.querySelectorAll('ol.nonfunctional.custom > li');
			for (let i = 0; i < nonfunctionalList.length; i++)
				nonfunctionalList[i].id = 'NF' + (i+1);
		</script>
		For the sake of completeness, a machine-readable <a href="model-requirements<.qak">model</a> is also available.
	</div>

	<h2>Problem analysis</h2>
	<div class="remark">
		<h4>Devices</h4>
		A possible abstraction gap is the communication with all the different devices in the parking area:
		<ul>
			<li><ks>weight sensor</ks>: </li>
			<li><ks>outsonar</ks>: Ultrasonic sensor that measures the distance of an obstacle in front of it.
				The customer provides an
				<a href="https://github.com/anatali/issLab2021/blob/main/it.unibo.rasp2021/resources/rasp/sonar/SonarAlone.c">example implementation</a>
				of a program reading the distance from the sensor.
				The sensor is connected to the software via a cable and supports platforms like Arduino and Raspberry Pi.</li>
			<li><ks>fan</ks>: can be controlled simply giving or removing power from it. A relay could be used to switch
			it on and off from a computer</li>
			<li><ks>thermometer</ks>: </li>
			<li><ks>transport trolley</ks>: The customer provides a set of utilities to interact with the robot, both in
				<a href="https://github.com/anatali/issLab2021/tree/main/it.unibo.qak21.basicrobot">qak</a> and
				<a href="https://github.com/anatali/issLab2021/tree/main/it.unibo.kotlinSupports">kotlin</a>.<br>
				In addition, is available an
				<a href="https://htmlpreview.github.io/?https://github.com/anatali/issLab2021/blob/master/it.unibo.virtualRobot2020/userDocs/VirtualRobot2021.html">API documentation</a> to communicate with the robot independently
				of the libraries provided.</li>
		</ul>

		<h4>Map of the parking-area</h4>
		The customer provides a
		<a href="https://github.com/anatali/issLab2021/blob/main/it.unibo.kotlinSupports/app/src/main/kotlin/mapRoomKotlin/mapUtil.kt">library</a>
		in Kotlin to represent the map of the parking-area.

		TODO: insert here map as grid with indications of all areas

		<!-- <h4>User interaction</h4> Da finire con eventuali altre user story -->
		<h4>Logical architecture</h4>
		The image above represents the logical architecture of the system.
		<br>
		<img style="max-width: 100%" src="img/logical-architecture.png" alt="Logical architecture">
		<br>
		It is also available an executable model of the system written in <a href="model.qak">qak language</a>.
	</div>

	<h2>Test plans</h2>
	<div class="remark">
		<ul>
			<li>client request a slot, and it's free: receive slotnum != 0 </li>
			<li>client request a slot, but there's no space: receive slotnum == 0</li>
			<li>client request a slot, but there's still a client before him: new client wait</li>
			<li>client press CARENTER, check: unique tokenid, slot become occupied, ?the weightsensor weight car?</li>
			<li>client pickup no error, check: slot become free, tokenid correspond, free outdoor area in tot time</li>
			<li>client pickup, but the token does not correspond, error</li>
			<li>client pickup, but there's still a client before him: new client wait</li>
			<li>manager checkstatus, receive sensible value</li>
			<li>? temperature over TMAX, check if robot stop</li>
			<li>manager start and stop robot</li>
			<li>manager start and stop fan</li>
		</ul>

		<table style="width:100%" border="1">
			<tr>
				<td>
					<h3>testRequestSlot</h3>
					The client request a slot and there is one slot free.
					<br/><b>Conditions</b>
					<ul>
						<li>The client receive 1 <= SLOTNUM <= 6</li>
						<li>The selected slot become reserved???</li>
					</ul>
				</td>

			</tr>

			<tr>
				<td>
					<h3>testRequestSlotNoSlotsFree</h3>
					The client request a slot but there is not a free slot.
					<br/><b>Conditions</b>
					<ul>
						<li>The client receive SLOTNUM == 0</li>
						<li></li>
					</ul>
				</td>
			</tr>

			<tr>
				<td>
					<h3>testRequestSlotIndoorOccupied</h3>
					The client request a slot, but there is still a client in the INDOOR-area
					<br/><b>Conditions</b>
					<ul>
						<li>The system notifies the client to wait before entering</li>
					</ul>
				</td>
			</tr>

			<tr>
				<td>
					<h3>testPressCarEnter</h3>
					The client request a slot, but there is still a client in the INDOOR-area
					<br/><b>Conditions</b>
					<ul>
						<li>The client receive a unique tokenID</li>
						<li>The selected parking slot become occupied</li>
						<li>?? The system weight the car ??</li>
					</ul>
				</td>
			</tr>

			<tr>
				<td>
					<h3>testClientPickup</h3>
					The client request to pick up his car by submitting the tokenID, and then leave
					<br/><b>Conditions</b>
					<ul>
						<li>The tokenID is valid</li>
						<li>The selected parking slot become free</li>
						<li>The OUTDOOR-area must be freed within TMAX time</li>
					</ul>
				</td>
			</tr>

			<tr>
				<td>
					<h3>testClientPickupOutdoorOccupied</h3>
					The client request to pick up his car by submitting the tokenID, but the OUTDOOR-area is occupied
					<br/><b>Conditions</b>
					<ul>
						<li>The tokenID is valid</li>
						<li>The system notifies the client to wait</li>
					</ul>
				</td>
			</tr>

			<tr>
				<td>
					<h3>testClientPickupWrongToken</h3>
					The client request to pick up his car by submitting the tokenID, but the tokenID is not valid
					<br/><b>Conditions</b>
					<ul>
						<li>The client receives an error from the system</li>
					</ul>
				</td>
			</tr>
		</table>
	</div>

	<h2>Work plan</h2>
	<div class="remark">
		We can assess the time needed to implement all the feature discussed above as follows:
		<ol>
			<li>Communication with devices (total 2 days)
				<ol>
					<li>Sonar: 3h</li>
					<li>Fan: 1h</li>
					<li>Thermometer: 2h</li>
					<li>Weight sensor: 2h</li>
					<li>Transport trolley: 1 day</li>
				</ol></li>
			<li>
				ParkManagerService core: 2 days
			</li>
			<li>API endpoints for 2 GUI: 3h</li>
			<li>ParkServiceGUI (total 10h)
			<ol>
				<li>Design (including chose of theme): 3h</li>
				<li>Realization (only client side): 7h</li>
			</ol>
			</li>
			<li>ParkServiceStatusGUI (total 7.5h)
			<ol>
				<li>Design (same theme of above): 1.5h</li>
				<li>Realization (only client side): 6h</li>
			</ol>
			</li>
		</ol>
		One day of work is equal to 8 working hours.<br>
		Total work estimate: 6 days and 4.5 hours.
	</div>

	<h2>Project</h2>
	<div class="remark">

	</div>

	<h2>Testing</h2>
	<div class="remark">

	</div>

	<h2>Deployment</h2>
	<div class="remark">

	</div>

	<h2>Maintenance</h2>
	<div class="remark">

	</div>
	<!-- USEFUL
	<table style="width:100%" border="1">
	<tr>
	<td style="width:50%">
	</td>
	<td></td>
	</tr>
	</table>
	-->

	<br/><br/>
</div>

<div style="background-color:rgba(86, 56, 253, 0.9); width:60%;text-align:left;color:white">
	By Alessandro Musarella <a style="color: white" href="mailto:alessandro.musarella@studio.unibo.it">alessandro.musarella@studio.unibo.it</a><br>
	By Giulio Tripi <a style="color: white" href="mailto:giulio.tripi@studio.unibo.it">giulio.tripi@studio.unibo.it</a><br>
	GitHub: <a style="color: white" href="https://github.com/giuliotripi/ParkManagerService">https://github.com/giuliotripi/ParkManagerService</a>
</div>
</body>
</html>